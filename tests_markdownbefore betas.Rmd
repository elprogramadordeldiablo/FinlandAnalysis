---
title: "GLMM and GLM Analysis"
author: "Rui Carvalho"
output:
  html_document:
    theme: united
    highlight: tango
    toc: yes
    toc_depth: 3
    toc_float:
      collapsed: no
      smooth_scroll: no
---

```{r setup, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
options(knitr.table.format = "html")

```


# Preparing files

## Libraries 

``` {r, results ='hide'}  
library(BAT)
library(readr)
library(FD) 
library(car)
library(MASS)
library(lme4)
library(here)       # to locate files
library(data.table) # to work with data
library(dplyr)      # to manage data
library(magrittr)   # to use the pipe operator %>% 
library(MuMIn)
library(glmmTMB)
library(bbmle)
```


## Calling results dataset

```{r}
Results2 <- read.csv2(here("results","RESULTS.csv"), header=TRUE, row.names = 1,  stringsAsFactors = T, sep = ",", dec = ".")
str(Results2)
```

## Checking for colinearity 

``{r}
results.variables <- Results2[,5:8] # selecting the variables relevant to the test

numeric.results.variables <- Results2[,6:8] # selecting the variables relevant to the test
cor(numeric.results.variables)  #isto ontem funcionava, nÃ£o sei o que se passa

``

# Alpha Taxonomic - All Species

## Generating the models
```{r}

gm1 <- glmer(TAlphaAll ~ Dist_edge_std + Dist_trail_std + Dist_trail_beginning_std + (1 | ForestID), data = Results2 , family = poisson)
options(na.action = "na.fail")
dredge(gm1)
```

# Alpha Taxonomic - Native Species

## Generating the models
```{r}

gm2 <- glmer(TAlphaNat ~ Dist_edge_std +Dist_trail_std + Dist_trail_beginning_std + (1 | ForestID), data = Results2 , family = poisson)
dredge(gm2)
```

# Alpha Taxonomic - Nind species

## Generating the models
```{r}

gm3 <- glmer(TAlphaNInd ~ Dist_edge_std + Dist_trail_std + Dist_trail_beginning_std + (1 | ForestID), data = Results2 , family = poisson)
summary(gm3)

```


# Alpha Fuctional - All Species

## Generating the models
```{r, warning=FALSE}

gm4 <- glmer(FAlphaAll ~ Dist_edge_std + Dist_trail_std + Dist_trail_beginning_std + (1 | ForestID), data = Results2 , family = Gamma)
dredge(gm4)
```

# Alpha Functional - Native Species

## Generating the models
```{r, warning=FALSE}

gm5 <- glmer(FAlphaNat ~ Dist_edge_std + Dist_trail_std + Dist_trail_beginning_std + (1 | ForestID), data = Results2 , family = Gamma)
dredge(gm5)
```

# Alpha Functional - N/Ind Species

## Generating the models
``{r, warning=FALSE}
gm6 <- glmer(FAlphaNInd ~ Dist_edge_std + Dist_trail_std + Dist_trail_beginning_std + (1 | ForestID), data = Results2 , family = Gamma)
options(na.action = "na.fail")
dredge(gm6,evaluate=FALSE)
``
FAILED - Error in eval(family$initialize, rho) : non-positive values not allowed for the 'gamma' family

## Model comparison table
``{r, warning=FALSE}
dredge(gm6, extra = c("R^2", F = function(x)
    summary(x)$fstatistic[[1]]))
``



# Beta Taxonomic - All Species

## Generating the models

```{r, warning=FALSE}

gm7 <- glmer(BetaAllTotalVector ~ Dist_edge_std + Dist_trail_std + Dist_trail_beginning_std + (1 | ForestID), data = Results2 , family = beta_family(link = "logit"))
dredge(gm7)


```


## Model comparison table
```{r, warning=FALSE}
dredge(gm7, extra = c("R^2", F = function(x)
    summary(x)$fstatistic[[1]]))

```

``{r, warning=FALSE}

gm7.5 <- glmer(formula = BetaAllTotalVector ~ Dist_trail_std + (1 | ForestID), data = Results2, family = binomial)
summary(gm7)

gm7.glmer(formula = BetaAllTotalVector ~ Dist_edge_std + Dist_trail_std + 
##     (1 | ForestID), data = Results2, family = binomial)
## 
## $`7`
## glmer(formula = BetaAllTotalVector ~ Dist_trail_beginning_std + 
##     Dist_trail_std + (1 | ForestID), data = Results2, family = binomial)

``


## Model comparison table
```{r, warning=FALSE}
gm8.6 <- glmer(BetaNatTotalVector ~ Dist_edge_std + Dist_trail_std +  (1 | ForestID), data = Results2 , family = binomial)
summary(gm8.6)
dredge(gm8, extra = c("R^2", F = function(x)
    summary(x)$fstatistic[[1]]))
```


# Beta Taxonomic - NInd Species

## Generating the models
```{r, warning=FALSE}

gm9 <- glmer(BetaNIndTotalVector ~ Dist_edge_std +  Dist_trail_std + Dist_trail_beginning_std + (1 | ForestID), data = Results2 , family = binomial)
dredge(gm9,evaluate=FALSE)
```


## Model comparison table
```{r, warning=FALSE}
dredge(gm9, extra = c("R^2", F = function(x)
    summary(x)$fstatistic[[1]]))

```



# FAILED Beta Functional - All 

## Generating the models
``{r, warning=FALSE}

gm10 <- glmer(BetaFuncAllTotalVector ~ Dist_edge_std +Dist_trail_std + Dist_trail_beginning_std + (1 | ForestID), data = Results2 , family = binomial)
dredge(gm10,evaluate=FALSE)
``
Error presented: "Error in pwrssUpdate(pp, resp, tol = tolPwrss, GQmat = GQmat, compDev = compDev, : (maxstephalfit) PIRLS step-halvings failed to reduce deviance in pwrssUpdate"

## Model comparison table
``{r, warning=FALSE}
dredge(gm10, extra = c("R^2", F = function(x)
    summary(x)$fstatistic[[1]]))

``


# FAILED Beta Functional - Nat 

## Generating the models
``{r, warning=FALSE}

gm11 <- glmer(BetaFuncNatTotalVector ~ Dist_edge_std +  Dist_trail_std + Dist_trail_beginning_std + (1 | ForestID), data = Results2 , family = binomial)
dredge(gm10,evaluate=FALSE)
``


## Model comparison table
``{r, warning=FALSE}
dredge(gm11, extra = c("R^2", F = function(x)
    summary(x)$fstatistic[[1]]))



``


# FAILED Beta Functional - NInd 

## Generating the models
``{r, warning=FALSE}

gm12 <- glmer(BetaFuncNIndTotalVector ~ Dist_edge_std +  Dist_trail_std + Dist_trail_beginning_std + (1 | ForestID), data = Results2 , family = binomial)
dredge(gm10,evaluate=FALSE)
``


## Model comparison table
``{r, warning=FALSE}
dredge(gm12, extra = c("R^2", F = function(x)
    summary(x)$fstatistic[[1]]))



``




